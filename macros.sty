\RequirePackage{graphicx}

\RequirePackage{hyperref}

\RequirePackage{mathtools}

\RequirePackage{tikz}
\usetikzlibrary{calc}

\RequirePackage{xcolor}

\RequirePackage{xparse}

\RequirePackage{xspace}

%-------------------------------------------------

\newcommand{\Chi}{%
  \mathrm{X}%
}

%-------------------------------------------------

\newcommand{\eqdef}{%
  \triangleq%
}

\newcommand{\eqbnf}{%
  \vcentcolon\vcentcolon=%
}

%-------------------------------------------------

\DeclareRobustCommand\onedot{\futurelet\@let@token\@onedot}
\def\@onedot{\ifx\@let@token.\else.\null\fi\xspace}

\def\eg{\emph{e.g}\onedot}
\def\ie{\emph{i.e}\onedot}
\def\etc{\emph{etc}\onedot}

%-------------------------------------------------

\newenvironment{inbox}[1][]{
  \begin{array}[#1]{@{}l@{}}
}{
  \end{array}
}

\newenvironment{inboxIndent}[1][]{
  \begin{array}[#1]{@{\hskip1em}l@{}}
}{
  \end{array}
}

%-------------------------------------------------

\newcommand{\C}{%
  C\xspace%
}

\newcommand{\Cameleer}{%
  Cameleer\xspace%
}

\newcommand{\CFML}{%
  CFML\xspace%
}

\newcommand{\Cosmo}{%
  Cosmo\xspace%
}

\newcommand{\Cpp}{%
  C\texttt{++}\xspace%
}

\newcommand{\Diaframe}{%
  Diaframe\xspace%
}

\newcommand{\DRFCaml}{%
  DRFCaml\xspace%
}

\newcommand{\Flambda}{%
  Flambda\xspace%
}

\newcommand{\Gallina}{%
  Gallina\xspace%
}

\newcommand{\Go}{%
  Go\xspace%
}

\newcommand{\Gospel}{%
  Gospel\xspace%
}

\newcommand{\Hacspec}{%
  Hacspec\xspace%
}

\newcommand{\Haskell}{%
  Haskell\xspace%
}

\newcommand{\HeapLang}{%
  HeapLang\xspace%
}

\newcommand{\Iris}{%
  Iris\xspace%
}

\newcommand{\Java}{%
  Java\xspace%
}

\newcommand{\Lean}{%
  Lean\xspace%
}

\newcommand{\MulticoreOCaml}{%
  Multicore~OCaml\xspace%
}

\newcommand{\OCaml}{%
  OCaml\xspace%
}

\newcommand{\OCamlFive}{%
  OCaml~5\xspace%
}

\newcommand{\OCamlFour}{%
  OCaml~4\xspace%
}

\newcommand{\Osiris}{%
  Osiris\xspace%
}

\newcommand{\Perennial}{%
  Perennial\xspace%
}

\newcommand{\Rocq}{%
  Rocq\xspace%
}

\newcommand{\Rust}{%
  Rust\xspace%
}

\newcommand{\RustBelt}{%
  RustBelt\xspace%
}

\newcommand{\WhyThree}{%
  Why3\xspace%
}

\newcommand{\Zoo}{%
  Zoo\xspace%
}

\newcommand{\ZooLang}{%
  ZooLang\xspace%
}

%-------------------------------------------------

\newcommand{\Domainslib}{%
  \texttt{Domainslib}\xspace%
}

\newcommand{\Eio}{%
  \texttt{Eio}\xspace%
}

\newcommand{\Kcas}{%
  \texttt{Kcas}\xspace%
}

\newcommand{\ocamlToZoo}{%
  \texttt{ocaml2zoo}\xspace%
}

\newcommand{\Picos}{%
  \texttt{Picos}\xspace%
}

\newcommand{\Saturn}{%
  \texttt{Saturn}\xspace%
}

%-------------------------------------------------

\newcommand{\mathhyphen}{%
  {\hbox{-}}%
}

\newcommand{\dplus}{%
  \mathbin{+\mkern-7mu+}%
}

%-------------------------------------------------

\newcommand{\textlog}[1]{%
  \textsf{\upshape #1}%
}

\newcommand{\loc}{%
  \ell%
}

%-------------------------------------------------

\newcommand{\mykeyword}[1]{%
  \textlog{\textbf{#1}}%
}

\newcommand{\myifOneline}[3]{%
  \mykeyword{if}\ #1\ \mykeyword{then}\ #2\ \mykeyword{else}\ #3%
}
\newcommand{\myif}[3]{%
  \begin{array}[t]{@{}l@{}}
      \mykeyword{if}\ #1\ \mykeyword{then}
    \\
      \begin{array}{@{\kern1em}l@{}}
        #2
      \end{array}
    \\
      \mykeyword{else}
    \\
      \begin{array}{@{\kern1em}l@{}}
        #3
      \end{array}
  \end{array}%
}

%-------------------------------------------------

\newcommand{\@recordBegin}{%
  \left\{\,%
}
\newcommand{\@recordEnd}{%
  \,\right\}%
}
\newcommand{\@recordField}[2]{%
  \textlog{#1} \kern-0.25em : #2%
}
\newcommand{\@recordSep}{%
  ;\,%
}
\newcommand{\recordOne}[2]{%
  \@recordBegin%
  \@recordField{#1}{#2}%
  \@recordEnd%
}
\newcommand{\recordTwo}[4]{%
  \@recordBegin%
  \@recordField{#1}{#2}%
  \@recordSep%
  \@recordField{#3}{#4}%
  \@recordEnd%
}
\newcommand{\recordThree}[6]{%
  \@recordBegin%
  \@recordField{#1}{#2}%
  \@recordSep%
  \@recordField{#3}{#4}%
  \@recordSep%
  \@recordField{#5}{#6}%
  \@recordEnd%
}
\newcommand{\recordFour}[8]{%
  \@recordBegin%
  \@recordField{#1}{#2}%
  \@recordSep%
  \@recordField{#3}{#4}%
  \@recordSep%
  \@recordField{#5}{#6}%
  \@recordSep%
  \@recordField{#7}{#8}%
  \@recordEnd%
}

\newcommand{\recordGet}[2]{%
  #1.\textlog{#2}%
}

%-------------------------------------------------

\newcommand{\mystackrel}[2]{%
  \stackrel{%
    \smash{%
      \raisebox{-.15ex}{%
        \ensuremath{%
          \scriptstyle \textlog{#1}%
        }%
      }%
    }%
  }{%
    #2%
  }%
}

\newcommand{\similar}[1][]{%
  \mystackrel{#1}{\approx}%
}

\newcommand{\nonsimilar}[1][]{%
  \mystackrel{#1}{\not\approx}%
}

%-------------------------------------------------

\newcommand{\interp}[1]{%
  \llbracket #1 \rrbracket%
}

%-------------------------------------------------

\newcommand{\Prop}{%
  \textlog{Prop}%
}

\newcommand{\iProp}{%
  \textlog{iProp}%
}

\newcommand{\iOr}{%
  \vee%
}

\newcommand{\iSep}{%
  \mathrel{\ast}%
}

\newcommand{\iBigSep}{%
  \scalerel*{\iSep}{\sum}%
}

\newcommand{\iWand}{%
  \mathrel{-\!\!\ast}%
}

\newcommand{\iBupd}{%
  |\!\!\!\Rrightarrow%
}

\newcommand{\iPersistent}{%
  \square%
}

\newcommand{\iTrue}{%
  \textlog{True}%
}
\newcommand{\iFalse}{%
  \textlog{False}%
}

\newcommand{\iPointsto}{%
  \mapsto%
}

\newcommand{\@iInv}[2]{%
  \tikz[baseline=(m.base)]{
    \node[rectangle, inner sep=0.8pt, outer sep=0.2pt, anchor=base] (m) {${\,#2\,}\mathstrut$} ;
    \draw[sharp corners, line width=0.2pt] ($(m.south west) + (0, 0.65pt)$) rectangle ($(m.north east) + (0, 0.7pt)$) ;
  }%
  \IfNoValueF{#1}{^{\,#1}}%
}
\newcommand{\iInv}[2][]{%
  \@iInv{#1}{%
    \begin{inbox}
      #2
    \end{inbox}%
  }%
}

\newcommand{\iPred}{%
  \Phi%
}
\newcommand{\iPredTwo}{%
  \Psi%
}
\newcommand{\iPredThree}{%
  \Chi%
}

\newcommand{\iType}{%
  \tau%
}

\newcommand{\iWp}[3][]{%
  \textlog{wp}\ %
  #2%
  \ \lbrace\ %
  \ifx #1 \else #1 \ldotp \fi%
  #3%
  \ \rbrace%
}

\newcommand{\iSpec}[4]{%
  \begin{array}{c}
      \begin{array}{c}
        #1
      \end{array}
    \\ \hline
      #2
    \\ \hline
      #3 \ldotp
      \begin{array}[t]{c}
        #4
      \end{array}
  \end{array}%
}

%-------------------------------------------------

\newlength\@inlinegraphicsHeight
\newlength\@inlinegraphicsDepth
\newcommand{\inlinegraphics}[2][1]{%
  \settototalheight\@inlinegraphicsHeight{Xygp}%
  \settodepth\@inlinegraphicsDepth{Xygp}%
  \raisebox{-#1\@inlinegraphicsDepth}{\includegraphics[height=\@inlinegraphicsHeight]{#2}}%
}

%-------------------------------------------------

\newcommand{\refLib}[1]{%
  \href{%
    https://github.com/clef-men/zoo/tree/popl26/lib/\detokenize{#1}%
  }{%
    \inlinegraphics[.5]{images/ocaml.png}%
  }%
}

\newcommand{\refTheories}[1]{%
  \ifx \relax#1\relax%
    \href{%
      https://github.com/clef-men/zoo/tree/popl26/theories/%
    }{%
      \inlinegraphics{images/rocq.png}%
    }%
  \else%
    \href{%
      https://github.com/clef-men/zoo/tree/popl26/theories/\string#1%
    }{%
      \inlinegraphics{images/rocq.png}%
    }%
  \fi%
}

\NewDocumentCommand\refLibTheories{O{} O{} m}{%
  \refLib{#3#1}~\refTheories{#3#2}%
}
\newcommand{\refLibTheoriesFile}[1]{%
  \refLibTheories[.ml][.v]{#1}%
}
